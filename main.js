const dictionary = {
    '홍': [
        { word: '홍수', rest: '처럼 밀려오는 주의 은혜가 당신의 평생에 가득하기를 축복합니다' },
        { word: '홍해', rest: '를 가르신 주님의 능력이 당신의 앞길에 놓인 장애물을 거두어 주실 것입니다' }
    ],
    '길': [
        { word: '길', rest: ' 되신 예수님과 함께 걷는 당신의 하루가 세상 무엇보다 빛나길 소망합니다' },
        { word: '길가', rest: '에 핀 작은 꽃에서도 하나님의 세밀한 사랑을 발견하는 지혜가 있기를' }
    ],
    '동': [
        { word: '동행', rest: '하시는 성령님의 따뜻한 손길이 외롭고 지친 마음을 위로해 주실 것입니다' },
        { word: '동녘', rest: '의 새벽빛처럼 당신의 믿음이 어둠을 밝히는 소망의 빛이 되길 기도합니다' }
    ],
    '이': [
        { word: '이제', rest: '는 주님 안에서 참된 평안을 누리며 날마다 새 힘을 얻는 당신이 되길' },
        { word: '이슬', rest: '처럼 맑은 영혼을 가진 당신을 통해 주님의 향기가 온 땅에 전해질 것입니다' }
    ],
    '김': [
        { word: '기도', rest: '하는 당신의 무릎을 통해 하나님은 이 땅에 놀라운 일들을 행하실 것입니다' },
        { word: '기쁨', rest: '의 찬양소리가 당신의 가정과 일터에서 끊이지 않기를 간절히 소망합니다' }
    ],
    '박': [
        { word: '박수', rest: '치며 주를 찬양하는 당신의 예배를 하나님께서 기쁘게 받아 주십니다' },
        { word: '박동', rest: '하는 심장마다 주를 향한 뜨거운 사랑이 식지 않는 은혜가 있기를' }
    ],
    '최': [
        { word: '최고', rest: '의 선물인 예수 그리스도를 가슴에 품고 살아가는 당신은 참으로 복된 사람입니다' },
        { word: '최선', rest: '을 다해 선한 싸움을 싸우는 당신의 등 뒤에서 주님이 늘 응원하고 계십니다' }
    ],
    '정': [
        { word: '정결', rest: '한 마음으로 주 앞에 서는 당신의 삶이 향기로운 제물 되어 드려지길' },
        { word: '정의', rest: '가 강물처럼 흐르는 세상을 만드는 데 귀하게 쓰임 받는 통로가 되길' }
    ],
    '나': [
        { word: '나', rest: '의 힘이 되신 여호와를 날마다 의지하며 넉넉히 승리하는 믿음의 장부 되길' },
        { word: '나그네', rest: ' 인생길에서도 천국 시민권을 가진 자의 당당함으로 살아가길 축복합니다' }
    ],
    '미': [
        { word: '미소', rest: ' 속에 깃든 주님의 평강이 당신을 만나는 모든 이들에게 위로가 될 것입니다' },
        { word: '미래', rest: '를 주관하시는 하나님께 모든 염려를 맡기고 평안을 누리는 오늘 되길' }
    ],
    '성': [
        { word: '성령', rest: '의 충만한 임재가 당신의 기폭제가 되어 세상을 변화시키는 능력이 되길' },
        { word: '성실', rest: '한 삶의 고백을 통해 주님의 살아계심을 증거하는 복된 증인 되길' }
    ],
    '민': [
        { word: '민족', rest: '을 가슴에 품고 기도하는 당신의 눈물이 이 땅을 치유하는 씨앗이 될 것입니다' },
        { word: '민들레', rest: ' 홀씨처럼 주의 복음이 당신의 발걸음을 통해 널리 퍼져나가길' }
    ],
    '지': [
        { word: '지혜', rest: '와 명철을 더하셔서 하나님의 뜻을 온전히 이루어 드리는 삶 되길 기도합니다' },
        { word: '지금', rest: ' 이 순간에도 하나님은 당신을 가장 아름다운 길로 인도하고 계십니다' }
    ],
    '수': [
        { word: '수고', rest: '하고 무거운 모든 짐을 주님 발 앞에 내려놓고 참된 안식을 얻길' },
        { word: '수정', rest: '처럼 맑고 깨끗한 마음으로 주님의 얼굴을 대면하는 은혜가 있기를' }
    ],
    '하': [
        { word: '하늘', rest: ' 가득한 주님의 영광이 당신의 삶 구석구석을 환하게 비추시길 축복합니다' },
        { word: '하나님', rest: '의 형상을 닮은 당신의 존재 자체가 세상을 향한 주님의 아름다운 편지입니다' }
    ],
    '윤': [
        { word: '윤슬', rest: '처럼 반짝이는 은혜의 물결이 당신의 메마른 영혼을 촉촉이 적셔주길' },
        { word: '윤택', rest: '한 영혼의 복이 당신의 자손 대대로 이어지기를 간절히 소망합니다' }
    ],
    '선': [
        { word: '선한', rest: ' 목자 되신 주님께서 당신의 모든 필요를 채우시고 안전하게 지키실 것입니다' },
        { word: '선물', rest: '로 주신 소중한 사람들과 함께 천국 잔치를 미리 맛보는 오늘 되길' }
    ],
    '영': [
        { word: '영원', rest: '토록 변함없는 주님의 사랑이 당신의 삶을 든든하게 붙들어 주실 것입니다' },
        { word: '영광', rest: '의 면류관을 얻기까지 믿음의 경주를 끝까지 완주하는 승리자 되길' }
    ],
    '전': [
        { word: '전능', rest: '하신 하나님의 손길이 당신의 삶에 가득한 모든 두려움을 몰아내 주시길' },
        { word: '전심', rest: '으로 주를 찾는 당신에게 하늘의 보화가 열리는 기적이 임하길 축복합니다' }
    ],
    '진': [
        { word: '진리', rest: '의 말씀이 당신의 앞길에 등불이 되어 실족치 않게 지켜주실 것입니다' },
        { word: '진실', rest: '한 고백을 기뻐하시는 주님 앞에 날마다 어린아이처럼 순전하게 서길' }
    ],
    '희': [
        { word: '희망', rest: '의 소망을 잃지 않고 기도로 나아가는 당신에게 주님은 반드시 응답하십니다' },
        { word: '희귀', rest: '하고 존귀한 보석보다 당신의 영혼을 더 사랑하시는 주님을 찬양합니다' }
    ],
    '은': [
        { word: '은혜', rest: ' 아래 거하는 삶이 얼마나 행복한지 당신의 얼굴을 통해 증거 되길 원합니다' },
        { word: '은총', rest: '의 구름 기둥으로 당신의 삶을 시원하게 덮으시고 인도하여 주시옵소서' }
    ],
    '혜': [
        { word: '혜안', rest: '을 주셔서 하나님의 일하심을 영적인 눈으로 바라보는 지혜자가 되길' },
        { word: '혜택', rest: '받은 은혜를 잊지 않고 늘 감사함으로 주님께 영광 돌리는 삶 되길' }
    ]
};

const fallbacks = [
    { word: '{char}심', rest: '으로 주를 경외하는 당신의 삶에 하늘의 평강이 가득하길 소망합니다' },
    { word: '{char}랑', rest: '스러운 주님의 자녀로서 세상에 선한 영향력을 끼치는 통로 되길' },
    { word: '{char}성', rest: '스러운 마음으로 주님을 섬기는 당신의 수고가 하늘의 상급으로 쌓이길' },
    { word: '{char}망', rest: '의 끈을 놓지 않고 끝까지 인내하며 믿음의 열매를 맺길 축복합니다' }
];

const generateBtn = document.getElementById('generateBtn');
const nameInput = document.getElementById('nameInput');
const resultArea = document.getElementById('resultArea');
const poemContent = document.getElementById('poemContent');
const copyBtn = document.getElementById('copyBtn');

generateBtn.addEventListener('click', () => {
    const name = nameInput.value.trim();
    if (!name) {
        alert('성함을 입력해주세요!');
        return;
    }
    generatePoem(name);
});

function generatePoem(name) {
    poemContent.innerHTML = '';
    const characters = name.split('');
    const usedPhrases = new Set();
    
    characters.forEach((char, index) => {
        const line = document.createElement('div');
        line.className = 'poem-line';
        line.style.animationDelay = `${index * 0.4}s`;
        
        let selected;
        if (dictionary[char]) {
            const options = dictionary[char].filter(o => !usedPhrases.has(o.word));
            selected = options.length > 0 ? options[Math.floor(Math.random() * options.length)] : dictionary[char][0];
        } else {
            const raw = fallbacks[Math.floor(Math.random() * fallbacks.length)];
            selected = {
                word: raw.word.replace('{char}', char),
                rest: raw.rest
            };
        }
        usedPhrases.add(selected.word);

        const firstChar = selected.word.charAt(0);
        const remainingWord = selected.word.substring(1);
        
        // 중요: word-rest와 rest 사이에 공백을 제거하여 자연스러운 문장 형성
        line.innerHTML = `<span class="first-char">${firstChar}</span><span class="word-rest">${remainingWord}</span>${selected.rest}`;
        poemContent.appendChild(line);
    });

    resultArea.classList.remove('hidden');
    if (window.navigator.vibrate) window.navigator.vibrate(10);

    setTimeout(() => {
        const yOffset = -20; 
        const element = resultArea;
        const y = element.getBoundingClientRect().top + window.pageYOffset + yOffset;
        window.scrollTo({top: y, behavior: 'smooth'});
    }, 100);
}

copyBtn.addEventListener('click', () => {
    const text = Array.from(document.querySelectorAll('.poem-line'))
        .map(el => el.innerText)
        .join('\n');
    
    navigator.clipboard.writeText(text).then(() => {
        const originalText = copyBtn.innerText;
        copyBtn.innerText = '✅ 축복 메시지 복사 완료!';
        copyBtn.classList.add('success');
        setTimeout(() => {
            copyBtn.innerText = originalText;
            copyBtn.classList.remove('success');
        }, 2000);
    });
});

nameInput.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
        generateBtn.click();
        nameInput.blur();
    }
});
