const dictionary = {
    '홍': [
        { word: '홍수', rest: '처럼 밀려오는 주의 은혜가 당신의 평생을 촉촉이 적셔주길 기도합니다' },
        { word: '홍해', rest: '를 가르신 기적의 하나님이 당신의 앞길을 평탄케 하시길 소망합니다' }
    ],
    '김': [
        { word: '기도', rest: '의 향연이 하늘 보좌에 상달되어 응답의 기쁨을 누리는 삶 되시길 축복합니다' },
        { word: '기쁨', rest: '이 샘물처럼 솟아나 당신의 주변까지 행복하게 만드는 통로가 되길 원합니다' }
    ],
    '이': [
        { word: '이제', rest: '는 주님 안에서 참된 안식을 누리며 날마다 새 힘을 얻는 복된 날 되소서' },
        { word: '이슬', rest: '처럼 맑은 영혼으로 세상을 비추며 주님의 사랑을 전하는 자 되길 바랍니다' }
    ],
    '박': [
        { word: '박수', rest: '치며 기쁨으로 주를 노래하는 당신의 예배가 하늘의 기쁨이 될 것입니다' },
        { word: '박동', rest: '하는 심장마다 주를 향한 뜨거운 열정이 식지 않는 은혜를 누리길' }
    ],
    '최': [
        { word: '최고', rest: '의 선물인 예수 그리스도와 함께 매일 기적 같은 삶을 살아가길 축복합니다' },
        { word: '최선', rest: '을 다해 믿음의 경주를 완주하는 당신에게 생명의 면류관이 예비되어 있습니다' }
    ],
    '정': [
        { word: '정결', rest: '한 마음으로 주 앞에 서는 당신의 삶이 향기로운 산 제물 되어 드려지길' },
        { word: '정의', rest: '가 강물처럼 흐르는 세상을 만드는 데 귀하게 쓰임 받는 일꾼 되소서' }
    ],
    '강': [
        { word: '강건', rest: '함과 평강이 당신의 가정과 일터 위에 영원히 함께하시기를 간절히 기도합니다' },
        { word: '강가', rest: '에 심은 나무가 시절을 좇아 과실을 맺듯 당신의 삶에 풍성한 열매가 있길' }
    ],
    '조': [
        { word: '조용', rest: '히 주의 음성에 귀 기울일 때 세상이 줄 수 없는 평안이 임할 것입니다' },
        { word: '조화', rest: '로운 삶의 고백을 통해 주님의 아름다우심이 온 땅에 전해지길 원합니다' }
    ],
    '윤': [
        { word: '윤슬', rest: '처럼 반짝이는 주님의 은혜가 당신의 모든 날들을 환하게 비추어 주시길' },
        { word: '윤택', rest: '한 영혼의 복이 당신의 자손 대대로 이어지는 명문 가문 이루시길' }
    ],
    '성': [
        { word: '성령', rest: '의 충만한 기름 부으심이 당신의 사역과 삶 위에 가득 넘쳐나길 소망합니다' },
        { word: '성실', rest: '한 삶의 고백을 통해 하나님의 살아계심을 증거하는 복된 증인 되소서' }
    ],
    '은': [
        { word: '은혜', rest: ' 아래 거하는 삶이 얼마나 행복한지 당신의 미소를 통해 세상이 보게 되길' },
        { word: '은총', rest: '의 구름 기둥이 당신이 걷는 모든 길을 시원하게 덮어 주시길 축복합니다' }
    ],
    '현': [
        { word: '현명', rest: '한 지혜로 선한 길을 선택하며 하나님을 기쁘시게 하는 삶 살아가길' },
        { word: '현존', rest: '하시는 하나님의 영광을 날마다 대면하며 거룩함을 입는 당신 되길' }
    ],
    '재': [
        { word: '재능', rest: '을 통해 주님의 나라를 확장하며 많은 이들에게 유익을 주는 통로 되소서' },
        { word: '재창조', rest: '하시는 주님의 손길로 날마다 속 사람이 새로워지는 은혜를 누리길' }
    ],
    '서': [
        { word: '서광', rest: '이 비치는 아침처럼 당신의 삶에 새로운 소망의 문이 활짝 열리길 기도합니다' },
        { word: '서로', rest: ' 사랑하며 주님의 명령을 온전히 이루어 드리는 아름다운 공동체 되길' }
    ],
    '민': [
        { word: '민족', rest: '과 열방을 품고 기도하는 당신의 눈물을 주께서 보석처럼 귀히 여기십니다' },
        { word: '민들레', rest: ' 홀씨처럼 주의 복음이 당신의 발걸음을 통해 널리 퍼져나가길 축복합니다' }
    ],
    '유': [
        { word: '유일', rest: '하신 하나님만을 경외하며 흔들리지 않는 믿음의 반석 위에 서시길' },
        { word: '유업', rest: '으로 주신 하늘의 보화가 당신의 삶에 가득 넘쳐나기를 소망합니다' }
    ],
    '한': [
        { word: '하늘', rest: ' 문을 여시고 쌓을 곳이 없도록 복을 부어주시는 풍성함을 경험하길' },
        { word: '한결', rest: '같은 주님의 사랑이 당신의 고단한 삶을 따뜻하게 안아 주실 것입니다' }
    ],
    '진': [
        { word: '진리', rest: '의 말씀이 당신의 앞길을 비추는 영롱한 빛이 되어 당신을 지켜주길' },
        { word: '진실', rest: '한 마음으로 드리는 당신의 예배를 주께서 가장 기쁘게 받으십니다' }
    ],
    '희': [
        { word: '희망', rest: '의 소망을 주시는 주님 안에서 날마다 새 힘을 얻고 승리하시길' },
        { word: '희귀', rest: '하고 존귀한 보석보다 당신의 존재를 더 사랑하시는 주님을 찬양합니다' }
    ],
    '영': [
        { word: '영원', rest: '하신 주님의 팔이 당신을 붙드시고 모든 환난에서 건져 주실 것입니다' },
        { word: '영광', rest: '의 빛이 당신의 삶 구석구석을 환하게 밝혀 주시기를 간절히 원합니다' }
    ],
    '준': [
        { word: '준비', rest: '하신 예비의 복이 당신의 삶에 적시적소에 임하는 기적을 체험하길' },
        { word: '준엄', rest: '한 주의 말씀 앞에 겸손히 순종하며 거룩한 길 걷는 당신 되소서' }
    ],
    '훈': [
        { word: '훈훈', rest: '한 성령의 바람이 당신의 마음에 불어와 사랑의 열매 맺게 하시길' },
        { word: '훈계', rest: '의 말씀을 금보다 귀히 여겨 지혜로운 자의 반열에 서는 당신 되길' }
    ],
    '지': [
        { word: '지혜', rest: '와 명철을 더하셔서 하나님의 뜻을 온전히 이루어 드리는 삶 되길' },
        { word: '지금', rest: ' 이 순간도 주님은 당신을 위해 말할 수 없는 탄식으로 간구하십니다' }
    ],
    '하': [
        { word: '하나님', rest: '의 형상을 닮은 당신은 존재 자체로 세상을 향한 아름다운 편지입니다' },
        { word: '하늘', rest: ' 가득한 주님의 영광이 당신의 앞길을 찬란하게 비추시길 축복합니다' }
    ],
    '나': [
        { word: '나', rest: '의 힘이 되신 여호와여 내가 주를 사랑합니다라는 고백이 넘쳐나길' },
        { word: '나그네', rest: ' 인생길에서도 천국 시민권을 가진 자의 당당함으로 살아가소서' }
    ]
};

const fallbacks = [
    { word: '{char}심', rest: '으로 주를 경외하는 당신의 삶에 하늘의 평강이 가득하길 소망합니다' },
    { word: '{char}랑', rest: '스러운 주님의 자녀로서 세상에 선한 영향력을 끼치는 통로 되길 축복합니다' },
    { word: '{char}성', rest: '스러운 마음으로 주님을 섬기는 당신의 수고를 주께서 기억하시고 복 주실 것입니다' },
    { word: '{char}망', rest: '의 소망을 품고 기도로 나아가는 당신의 내일이 오늘보다 빛나길 원합니다' },
    { word: '{char}연', rest: '히 주어지는 은혜가 아니라 하나님께서 당신을 위해 예비하신 특별한 선물입니다' },
    { word: '{char}광', rest: '스러운 주님의 일에 참여하는 기쁨이 당신의 영혼에 가득하기를 축복합니다' }
];

const generateBtn = document.getElementById('generateBtn');
const nameInput = document.getElementById('nameInput');
const resultArea = document.getElementById('resultArea');
const poemContent = document.getElementById('poemContent');
const copyBtn = document.getElementById('copyBtn');

generateBtn.addEventListener('click', () => {
    const name = nameInput.value.trim();
    if (!name) {
        alert('성함을 입력해주세요!');
        return;
    }
    generatePoem(name);
});

function generatePoem(name) {
    poemContent.innerHTML = '';
    const characters = name.split('');
    const usedWords = new Set();
    
    characters.forEach((char, index) => {
        const line = document.createElement('div');
        line.className = 'poem-line';
        line.style.animationDelay = `${index * 0.4}s`;
        
        let selected;
        if (dictionary[char]) {
            const options = dictionary[char].filter(o => !usedWords.has(o.word));
            selected = options.length > 0 ? options[Math.floor(Math.random() * options.length)] : dictionary[char][0];
        } else {
            // Fallback 중복 방지 로직 개선
            const options = fallbacks.filter(o => !usedWords.has(o.word.replace('{char}', char)));
            const raw = options.length > 0 ? options[Math.floor(Math.random() * options.length)] : fallbacks[0];
            selected = {
                word: raw.word.replace('{char}', char),
                rest: raw.rest
            };
        }
        usedWords.add(selected.word);

        const firstChar = selected.word.charAt(0);
        const remainingWord = selected.word.substring(1);
        
        line.innerHTML = `<span class="first-char">${firstChar}</span><span class="word-rest">${remainingWord}</span>${selected.rest}`;
        poemContent.appendChild(line);
    });

    resultArea.classList.remove('hidden');
    if (window.navigator.vibrate) window.navigator.vibrate(10);

    setTimeout(() => {
        const yOffset = -20; 
        const element = resultArea;
        const y = element.getBoundingClientRect().top + window.pageYOffset + yOffset;
        window.scrollTo({top: y, behavior: 'smooth'});
    }, 100);
}

copyBtn.addEventListener('click', () => {
    const text = Array.from(document.querySelectorAll('.poem-line'))
        .map(el => el.innerText)
        .join('\n');
    
    navigator.clipboard.writeText(text).then(() => {
        const originalText = copyBtn.innerText;
        copyBtn.innerText = '✅ 축복 메시지 복사 완료!';
        copyBtn.classList.add('success');
        setTimeout(() => {
            copyBtn.innerText = originalText;
            copyBtn.classList.remove('success');
        }, 2000);
    });
});

nameInput.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
        generateBtn.click();
        nameInput.blur();
    }
});
