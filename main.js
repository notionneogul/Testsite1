const dictionary = {
    '홍': [
        { phrase: '홍수같이 밀려오는 주의 은혜가 당신의 삶을 촉촉이 적시고,' },
        { phrase: '홍해를 가르신 기적의 하나님이 당신의 앞길을 예비하시며,' }
    ],
    '김': [
        { phrase: '기도의 향연이 하늘 보좌에 닿아 당신의 모든 간구가 응답되고,' },
        { phrase: '기쁨의 샘물이 영혼 깊은 곳에서 솟아나 날마다 당신을 새롭게 하며,' }
    ],
    '이': [
        { phrase: '이토록 아름다운 주님의 사랑이 당신의 평생에 마르지 않으며,' },
        { phrase: '이슬같이 맑은 주의 평강이 당신의 마음을 평안케 지켜주시길,' }
    ],
    '박': [
        { phrase: '박수 소리 가득한 찬양의 기쁨이 당신의 가정에 늘 충만하고,' },
        { phrase: '박동하는 심장마다 주를 향한 뜨거운 사랑이 식지 않기를,' }
    ],
    '최': [
        { phrase: '최고의 선물인 예수 그리스도와 함께 매 순간 기적을 경험하며,' },
        { phrase: '최선을 다해 믿음의 경주를 완주하는 당신에게 상급이 예비되길,' }
    ],
    '정': [
        { phrase: '정결한 마음으로 주 앞에 서서 하늘의 신령한 지혜를 얻고,' },
        { phrase: '정의가 강물처럼 흐르는 세상을 만드는 복된 통로로 쓰임 받으며,' }
    ],
    '강': [
        { phrase: '강건함과 평안이 당신의 영혼과 육신 위에 영원히 함께하고,' },
        { phrase: '강가에 심은 나무가 시절을 좇아 풍성한 열매를 맺듯이,' }
    ],
    '조': [
        { phrase: '조용히 주의 음성에 귀 기울이며 세상이 줄 수 없는 평안을 누리고,' },
        { phrase: '조화로운 삶의 고백을 통해 주님의 아름다우심을 온 땅에 비추며,' }
    ],
    '윤': [
        { phrase: '윤슬처럼 반짝이는 은혜의 물결이 당신의 모든 날을 환하게 비추고,' },
        { phrase: '윤택한 영혼의 복이 당신의 자손 대대로 이어지는 역사가 있기를,' }
    ],
    '성': [
        { phrase: '성령의 충만한 기름 부으심이 당신의 사역과 삶 위에 가득 넘치고,' },
        { phrase: '성실한 삶의 향기로 하나님의 살아계심을 증거하는 증인이 되며,' }
    ],
    '은': [
        { phrase: '은혜 아래 거하는 삶의 행복이 당신의 미소 속에 늘 머물고,' },
        { phrase: '은총의 구름 기둥이 당신이 걷는 모든 길을 시원하게 인도하시길,' }
    ],
    '현': [
        { phrase: '현명한 지혜로 선한 길을 선택하여 하나님을 날마다 기쁘시게 하고,' },
        { phrase: '현존하시는 하나님의 영광을 대면하며 거룩함으로 옷 입는 당신 되길,' }
    ],
    '재': [
        { word: '재능을 통해 주님의 나라를 확장하며 많은 이들에게 유익을 끼치고,' },
        { word: '재창조하시는 주님의 손길로 날마다 속 사람이 새로워지는 은혜를 누리며,' }
    ],
    '서': [
        { phrase: '서광이 비치는 아침처럼 당신의 삶에 새로운 소망의 문이 활짝 열리고,' },
        { phrase: '서로 사랑하며 주님의 명령을 온전히 이루어 드리는 사랑의 통로가 되어,' }
    ],
    '민': [
        { phrase: '민족과 열방을 품고 기도하는 당신의 눈물이 보석처럼 귀하게 쓰이고,' },
        { phrase: '민들레 홀씨처럼 주의 복음이 당신의 발걸음을 통해 널리 퍼져나가며,' }
    ],
    '유': [
        { phrase: '유일하신 하나님만을 온전히 경외하며 믿음의 반석 위에 굳게 서고,' },
        { phrase: '유업으로 주신 하늘의 보화가 당신의 삶과 가정에 차고 넘치기를,' }
    ],
    '한': [
        { phrase: '하늘 문을 여시고 쌓을 곳이 없도록 부으시는 풍성한 복을 경험하며,' },
        { phrase: '한결같은 주님의 사랑이 당신의 고단한 삶을 따뜻하게 안아 주시길,' }
    ],
    '진': [
        { phrase: '진리의 말씀이 당신의 앞길을 비추는 영롱한 빛이 되어 당신을 지키고,' },
        { phrase: '진실한 마음으로 드리는 당신의 예배를 주께서 기쁘게 받으시기를,' }
    ],
    '희': [
        { phrase: '희망의 소망을 주시는 주님 안에서 날마다 새 힘을 얻고 승리하며,' },
        { phrase: '희귀하고 존귀한 보석보다 당신을 더 사랑하시는 주의 품에 거하길,' }
    ],
    '영': [
        { phrase: '영원하신 주님의 팔이 당신을 붙드시고 모든 환난에서 건져 평안케 하며,' },
        { phrase: '영광의 빛이 당신의 삶 구석구석을 비추어 어둠을 몰아내고 생명을 노래하길,' }
    ],
    '준': [
        { phrase: '준비하신 여호와 이레의 복이 당신의 삶에 적시적소에 임하는 기적을 보고,' },
        { phrase: '준엄한 주의 말씀 앞에 겸손히 순종하며 거룩한 길 걷는 자녀가 되기를,' }
    ],
    '지': [
        { phrase: '지혜와 명철을 하늘로부터 공급받아 하나님의 선하신 뜻을 온전히 이루고,' },
        { phrase: '지금 이 순간도 당신을 위해 중보하시는 주님의 사랑을 깊이 신뢰하며,' }
    ],
    '하': [
        { phrase: '하나님의 형상을 닮은 당신의 존재 자체가 세상을 향한 아름다운 편지가 되고,' },
        { phrase: '하늘 가득한 주님의 영광이 당신의 평생에 찬란한 소망으로 머물기를,' }
    ],
    '나': [
        { phrase: '나의 힘이 되신 여호와를 날마다 의지하며 승리의 고백이 넘쳐나고,' },
        { phrase: '나그네 인생길에서도 천국 시민의 당당함과 기쁨으로 승리하며 살아가길,' }
    ],
    '수': [
        { phrase: '수고하고 무거운 짐을 주님께 맡기고 주가 주시는 참된 안식과 쉼을 누리며,' },
        { phrase: '수정같이 맑은 생명수 강가로 당신의 영혼을 인도하시는 평강을 맛보기를,' }
    ]
};

const fallbacks = [
    '{char}심으로 주를 경외하는 당신의 삶에 하늘의 평강이 가득하길 소망하며,',
    '{char}랑스러운 주님의 자녀로서 세상에 선한 영향력을 끼치는 통로가 되고,',
    '{char}성스러운 마음으로 주를 섬기는 당신의 수고를 주께서 기억하시며,',
    '{char}망의 소망을 품고 끝까지 인내하며 믿음의 열매를 거두는 삶 되시길,'
];

const finalBliss = [
    '주님의 이름으로 당신을 축복합니다.',
    '영원토록 주와 동행하는 복된 인생 되소서.',
    '예수 그리스도의 은혜가 늘 함께하시길 기도합니다.',
    '하늘의 평강이 당신의 마음을 지켜주시길 원합니다.'
];

const generateBtn = document.getElementById('generateBtn');
const nameInput = document.getElementById('nameInput');
const resultArea = document.getElementById('resultArea');
const poemContent = document.getElementById('poemContent');
const copyBtn = document.getElementById('copyBtn');

generateBtn.addEventListener('click', () => {
    const name = nameInput.value.trim();
    if (!name) {
        alert('성함을 입력해주세요!');
        return;
    }
    generatePoem(name);
});

function generatePoem(name) {
    poemContent.innerHTML = '';
    const characters = name.split('');
    const usedPhrases = new Set();
    
    characters.forEach((char, index) => {
        const line = document.createElement('div');
        line.className = 'poem-line';
        line.style.animationDelay = `${index * 0.4}s`;
        
        let phrase = '';
        if (dictionary[char]) {
            const options = dictionary[char].filter(o => !usedPhrases.has(o.phrase));
            const selected = options.length > 0 ? options[Math.floor(Math.random() * options.length)] : dictionary[char][0];
            phrase = selected.phrase;
        } else {
            const rawFallback = fallbacks[Math.floor(Math.random() * fallbacks.length)];
            phrase = rawFallback.replace('{char}', char);
        }
        usedPhrases.add(phrase);

        const firstChar = phrase.charAt(0);
        const restOfPhrase = phrase.substring(1);
        
        line.innerHTML = `<span class="first-char">${firstChar}</span>${restOfPhrase}`;
        poemContent.appendChild(line);
    });

    // 마지막 축복 문구 추가 (전체 문장을 완성하는 느낌)
    const lastLine = document.createElement('div');
    lastLine.className = 'poem-line final-line';
    lastLine.style.animationDelay = `${characters.length * 0.4}s`;
    lastLine.innerText = finalBliss[Math.floor(Math.random() * finalBliss.length)];
    poemContent.appendChild(lastLine);

    resultArea.classList.remove('hidden');
    if (window.navigator.vibrate) window.navigator.vibrate(10);

    setTimeout(() => {
        const yOffset = -50;
        const y = resultArea.getBoundingClientRect().top + window.pageYOffset + yOffset;
        window.scrollTo({top: y, behavior: 'smooth'});
    }, 150);
}

copyBtn.addEventListener('click', () => {
    const text = Array.from(document.querySelectorAll('.poem-line'))
        .map(el => el.innerText)
        .join('\n');
    
    navigator.clipboard.writeText(text).then(() => {
        const originalText = copyBtn.innerText;
        copyBtn.innerText = '✅ 축복 메시지 복사 완료!';
        copyBtn.classList.add('success');
        setTimeout(() => {
            copyBtn.innerText = originalText;
            copyBtn.classList.remove('success');
        }, 2000);
    });
});

nameInput.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
        generateBtn.click();
        nameInput.blur();
    }
});
